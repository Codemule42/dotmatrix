# ~/.washrc
# vim:set ft=sh sw=2 sts=2:

[ -e "$WORK" ] || WORK_DIR="$HOME/work"
[ -e "$PLAY" ] || PLAY_DIR="$HOME/play"
export WORK_DIR
export PLAY_DIR

for dir in /opt/local/bin /usr/local/bin "$HOME/bin"; do
  case "$PATH:" in
    *:"$dir":*) PATH="`echo "$PATH"|sed -e "s#:$dir##"`" ;;
  esac
  [ ! -d "$dir" ] || PATH="$dir:$PATH"
done
for dir in /usr/local/sbin /opt/local/sbin; do
  case ":$PATH:" in
    *:"$dir":*) ;;
    *) [ ! -d "$dir" ] || PATH="$PATH:$dir" ;;
  esac
done

pcd() {
  cd "$PLAY_DIR/$1"
}

wcd() {
  cd "$WORK_DIR/$1"
}

# Tab completion
if [ -n "$BASH_VERSION" ]; then
  _wcd()
  {
    local cur projects

    [ -r "$PLAY_DIR" ] || return 0

    eval 'COMPREPLY=()'
    cur=${COMP_WORDS[COMP_CWORD]}
    projects=$(\ls "$PLAY_DIR")

    if [ $COMP_CWORD -eq 1 ]; then
      eval 'COMPREPLY=( $(compgen -o filenames -W "$projects" $cur) )'
    fi

    return 0
  }
  complete -F _wcd wcd wclone
elif [ -n "$ZSH_VERSION" ]; then
  #compdef '_files -W "$PLAY_DIR"' wcd wclone
  compctl -/ -W "$PLAY_DIR" pcd
  compctl -/ -W "$WORK_DIR" wcd
fi

rails_root() {
  (
  dir=${1:-$(pwd)}
  i=0
  while [ "/" != "$dir" -a "$i" -ne 16 ]; do
    if [ -f "$dir/config/environment.rb" ]; then
      echo "$dir"
      return 0
    fi
    dir="$(dirname "$dir")"
    i=$(expr $i + 1)
  done
  return 1
  )
}

script_rails() {
  if [ -f "`rails_root`/script/rails" ]; then
    "`rails_root`/script/rails" "$@"
  else
    local name
    name="$1"
    shift
    "`rails_root`/script/$name" "$@"
  fi
}

alias sc='script_rails console'
alias ss='script_rails server -u'
alias sdbc='script_rails dbconsole -p'

alias testify="watchr ~/.watchr.rb"
alias vanguard="guard -c -n false"
alias vangaurd="vanguard"

alias ll='ls -l'

alias gap='git add -p'
alias gb='git branch'
alias gc='git commit -v'
alias gca='git commit -a -v'
alias gco="git checkout"
alias gd='git diff'
alias gdc='git diff --cached'
alias gdh='git diff HEAD'
alias gl='git pull'
alias glod='git log --oneline --decorate'
alias gp='git push'
alias gpr='git pull --rebase'
alias grep='grep --color=auto --exclude="*~"'
alias gst='git status'
alias gr='git rebase'
alias grc='git rebase --continue'
alias gra='git rebase --abort'
alias vi='vim'

